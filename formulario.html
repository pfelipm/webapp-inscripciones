<!DOCTYPE html>
<html>
  
  <head>
  
    <base target="_top">

    <!-- Inserta c√≥digo css parametrizado -->
    <?
      const css = HtmlService.createTemplateFromFile('css');
      const hdc = SpreadsheetApp.getActive();
      css.colorTema = hdc.getRange(PARAM.colorTema).getValue();
      css.anchoImagen = hdc.getRange(PARAM.anchoImagen).getValue();
    ?>
    <?!= css.evaluate().getContent(); ?>

  </head>
  
  <body>
    
    <div class="container">

      <!-- Elementos del encabezado parametrizados desde doGet() -->

      <img src="<?= imagenCabecera ?>">
      <h<?= tamEncabezado ?>><?= textoEncabezado ?></h<?!= tamEncabezado ?>>


    <!-- ¬øFormulario en mantenimiento ? -->

    <? if (hdc.getRange(PARAM.checkMantenimiento).getValue()) { ?>
      
      <p class="instrucciones">üõ†Ô∏è El formulario est√° temporalmente desactivado por labores de mantenimiento üõ†Ô∏è</p>

    <? } else { ?>

    <!-- ¬øFormulario abierto o cerrado? -->

    <?
      const checkActivar = hdc.getRange(PARAM.checkActivar).getValue();
      const apertura = hdc.getRange(PARAM.apertura).getValue();
      const cierre = hdc.getRange(PARAM.cierre).getValue();
      const checkPeriodo = hdc.getRange(PARAM.checkPeriodo).getValue();
      const ahora = new Date();
      const formularioAbierto = checkPeriodo ? (ahora >= apertura && ahora < cierre ? true : false) : checkActivar;
      if (!formularioAbierto) {
    ?>

      <p class="instrucciones"><?!= hdc.getRange(PARAM.textoCerrado).getValue() ?></p>
      
      </div> <!-- Container -->
      </body>
      </html>
      <!-- ¬°Y se acab√≥! -->
    
    <? } else { ?>
    
      <p class="instrucciones"><?!= hdc.getRange(PARAM.textoAbierto).getValue() ?></p>
  
      <form id="formulario">

        <!-- Inserta c√≥digo HTML para mostrar los campos de identificaci√≥n y el bot√≥n del formulario -->
        <?
          const campos = hdc.getRange(PARAM.camposId.rango).getValues();
          const camposGenerar = PARAM.camposId.cols.filter(col => campos[PARAM.camposId.etiquetaCol][col]);
          camposGenerar.forEach((campo, indice) => {
            if (camposGenerar.length == 1)  { ?>
              <div class="row">
                <div class="input-field col s6 offset-s3 l4 offset-l4 campoUnico">
            <? } else if (indice % 2 == 0 && camposGenerar.length > 1)  { ?>
              <div class="row">
                <div class="input-field col s5 offset-s1 l4 offset-l2 xl3 offset-xl3 campoIzq">
            <? } else { ?>
                <div class="input-field col s5 l4 xl3 campoDer">
            <? } ?>
                  <i class="material-icons prefix"><?= campos[PARAM.camposId.iconoCol][campo] ?></i>
                  <input pattern="<?= campos[PARAM.camposId.expRegCol][campo] ?>" id="<?= `campo${indice+1}` ?>" name="<?= `campo${indice+1}` ?>" type="text"
                  required aria-required="true" <?!= campos[PARAM.camposId.expRegCol][campo] ? 'class="validate"' : ''?>>
                  <label for="<?= `campo${indice+1}` ?>"><?= campos[PARAM.camposId.etiquetaCol][campo] ?></label>
                  <span class="helper-text" data-error="<?= campos[PARAM.camposId.txtValCol][campo] ?>"><?= campos[PARAM.camposId.ayudaCol][campo] ?></span>
                </div>
            <? if (indice % 2 == 0 && indice + 1 == camposGenerar.length || indice % 2 == 1)  { ?>
              </div>
            <? }
          });
        ?>

        <!-- Bot√≥n de inscripci√≥n -->
        <div id="div_btn_guardar" class="row center-align">
          <button type="submit" disabled id="btn_guardar" class="btn waves-effect waves-light btn-large"><i class="material-icons left"><?= btnIcono ?></i><?= btnEtiqueta ?></a>
        </div>

        <div class="mensaje hide" id="mensaje"></div>

        <div class="progress" id="barraProgreso">
          <div class="indeterminate" style="width: 70%"></div>
        </div>
        
        <!-- Pesta√±as de selecci√≥n de talleres -->
        <div class="row" id="tabArea">

        </div>

      </form>

    </div> <!-- Container -->
  
  </body>

  <!-- Inserta c√≥digo JavaScript -->
  <?!= HtmlService.createHtmlOutputFromFile('js').getContent(); ?>


</html>

<? } }?>   